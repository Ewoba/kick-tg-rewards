# ‚úÖ –ß–¢–û –°–î–ï–õ–ê–¢–¨ –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°

## ‚úÖ –®–∞–≥ 1: Docker ‚Äî –ì–û–¢–û–í–û ‚úÖ

**–°—Ç–∞—Ç—É—Å**: Postgres –∏ Redis –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

---

## ‚úÖ –®–∞–≥ 2: –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –ü–†–ò–ú–ï–ù–ï–ù–´ ‚úÖ

**–°—Ç–∞—Ç—É—Å**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å Prisma schema

**–ß—Ç–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `OAuthState` —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ü–æ–ª–µ `nonceUsed` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `WalletVerification`
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `nonce` —Å–æ–∑–¥–∞–Ω
- ‚úÖ Prisma Client —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω

---

## ‚ö†Ô∏è –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ADMIN_TWITCH_IDS (–°–î–ï–õ–ê–ô–¢–ï –≠–¢–û)

### –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env`:

```powershell
cd C:\Users\Admin\Downloads\drops\drops-crypto-api
notepad .env
```

### –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:

```env
ADMIN_TWITCH_IDS=–≤–∞—à_twitch_user_id
```

**–ü—Ä–∏–º–µ—Ä:**
```env
ADMIN_TWITCH_IDS=123456789
```

**–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤:**
```env
ADMIN_TWITCH_IDS=123456789,987654321
```

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–≤–æ–π Twitch User ID:

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–∫–µ–Ω)

```powershell
cd drops-crypto-api
.\get-twitch-user-id.ps1 -Token "–≤–∞—à_jwt_—Ç–æ–∫–µ–Ω"
```

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Prisma Studio

```powershell
cd drops-crypto-api
npx prisma studio
```

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `User` ‚Üí —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ `twitchUserId`

#### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ JWT decoder

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è/–ª–æ–≥–æ–≤
2. –û—Ç–∫—Ä–æ–π—Ç–µ: https://jwt.io
3. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω ‚Üí –≤ payload –Ω–∞–π–¥–∏—Ç–µ `twitchUserId`

#### –°–ø–æ—Å–æ–± 4: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å JWT

1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (OAuth flow)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JWT —Ç–æ–∫–µ–Ω (decoded) ‚Üí —Ç–∞–º –µ—Å—Ç—å `twitchUserId`

---

## ‚úÖ –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend

```powershell
cd C:\Users\Admin\Downloads\drops\drops-crypto-api
npm run start:dev
```

–î–æ–∂–¥–∏—Ç–µ—Å—å: `Nest application successfully started`

---

## üîç –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)

### ‚úÖ 1. API –∂–∏–≤

```
http://localhost:3000/health
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è**: `{ "ok": true }`

### ‚úÖ 2. OAuth state —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:3000/auth/twitch/start`
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å ‚Üí –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ callback URL –¥–≤–∞–∂–¥—ã ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ ‚úÖ

### ‚úÖ 3. Admin Guard —Ä–∞–±–æ—Ç–∞–µ—Ç

**–¢–µ—Å—Ç 1: –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí 403**
```powershell
$token = "–æ–±—ã—á–Ω—ã–π_—Ç–æ–∫–µ–Ω"
$headers = @{ Authorization = "Bearer $token" }
Invoke-RestMethod -Uri http://localhost:3000/admin/claims -Headers $headers
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è**: `403 Forbidden` ‚úÖ

**–¢–µ—Å—Ç 2: –ê–¥–º–∏–Ω ‚Üí 200**
```powershell
$token = "admin_—Ç–æ–∫–µ–Ω"  # twitchUserId –≤ ADMIN_TWITCH_IDS
$headers = @{ Authorization = "Bearer $token" }
Invoke-RestMethod -Uri http://localhost:3000/admin/claims -Headers $headers
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è**: –°–ø–∏—Å–æ–∫ claims ‚úÖ

### ‚úÖ 4. SIWE Nonce –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π

1. `POST /me/wallet/nonce` ‚Üí –ø–æ–ª—É—á–∏—Ç–µ nonce
2. `POST /me/wallet/verify` ‚Üí –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–æ—Ç –∂–µ nonce/signature —Å–Ω–æ–≤–∞ ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ "Nonce already used" ‚úÖ

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

- ‚úÖ Docker —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚ö†Ô∏è **ADMIN_TWITCH_IDS –Ω–∞—Å—Ç—Ä–æ–µ–Ω** (—Å–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ!)
- ‚ö†Ô∏è **Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω** (—Å–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ!)

---

## üöÄ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ!**

–°–ª–µ–¥—É–π—Ç–µ `TESTING_CHECKLIST.md` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
